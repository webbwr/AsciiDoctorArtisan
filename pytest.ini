[pytest]
# Pytest configuration for AsciiDoc Artisan

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output options
addopts =
    -v
    --strict-markers
    --tb=short
    --disable-warnings
    -p no:xvfb
    # Parallel execution disabled on macOS (Security.framework issue)
    # For Linux/Windows add: -n auto

# Test paths
testpaths = tests

# Asyncio configuration (pytest-asyncio >= 0.23.0)
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Anyio configuration (use asyncio backend only, not trio)
anyio_backends = asyncio

# Markers for test organization
markers =
    unit: Unit tests for individual functions and classes
    integration: Integration tests with external tools (Pandoc, Git)
    gui: GUI tests using pytest-qt
    slow: Tests that take significant time to run
    benchmark: Performance benchmark tests (Phase 4)
    performance: Performance profiling and baseline tests
    asyncio: Async I/O tests
    memory: Memory leak and usage tests
    stress: Stress and load testing
    property: Property-based tests using Hypothesis (fuzz testing)
    visual: Visual regression tests using pytest-regressions (screenshot comparisons)
    timeout: Tests with timeout constraints to prevent hanging
    live_api: Tests requiring live API access (Claude, Ollama) - manual run only
    forked: Tests requiring process isolation (pytest-forked) - Qt worker thread isolation
    fast: Fast tests (<0.1s) - unit tests, simple mocks
    medium: Medium tests (0.1-1s) - moderate complexity
    flaky: Flaky tests that may fail intermittently (auto-retry with pytest-rerunfailures)
    e2e: End-to-end workflow tests
    # FR markers - Functional Requirements from SPECIFICATIONS_V2.md
    # Core Editing (FR-001-020)
    fr_001: FR-001 Text Editor
    fr_002: FR-002 Line Numbers
    fr_003: FR-003 Undo/Redo
    fr_004: FR-004 Font Customization
    fr_005: FR-005 Editor State
    fr_006: FR-006 Open Files
    fr_007: FR-007 Save Files
    fr_008: FR-008 Save As
    fr_009: FR-009 New Document
    fr_010: FR-010 Recent Files
    fr_011: FR-011 Auto-Save
    fr_012: FR-012 Import DOCX
    fr_013: FR-013 Import PDF
    fr_014: FR-014 Import Markdown
    fr_015: FR-015 Live Preview
    fr_016: FR-016 GPU Acceleration
    fr_017: FR-017 Scroll Sync
    fr_018: FR-018 Incremental Render
    fr_019: FR-019 Debounce
    fr_020: FR-020 Preview Themes
    # Export & Conversion (FR-021-025)
    fr_021: FR-021 Export HTML
    fr_022: FR-022 Export PDF
    fr_023: FR-023 Export DOCX
    fr_024: FR-024 Export Markdown
    fr_025: FR-025 AI Export Enhancement
    # Git Integration (FR-026-033)
    fr_026: FR-026 Select Repo
    fr_027: FR-027 Git Commit
    fr_028: FR-028 Git Pull
    fr_029: FR-029 Git Push
    fr_030: FR-030 Git Status Bar
    fr_031: FR-031 Git Status Dialog
    fr_032: FR-032 Quick Commit
    fr_033: FR-033 Cancel Git Ops
    # GitHub CLI (FR-034-038)
    fr_034: FR-034 Create PR
    fr_035: FR-035 List PRs
    fr_036: FR-036 Create Issue
    fr_037: FR-037 List Issues
    fr_038: FR-038 View Repo
    # AI Features (FR-039-044)
    fr_039: FR-039 Ollama Chat Panel
    fr_040: FR-040 Chat Modes
    fr_041: FR-041 Model Selection
    fr_042: FR-042 Chat History
    fr_043: FR-043 Ollama Integration
    fr_044: FR-044 Status Indicator
    # Find & Replace (FR-045-049)
    fr_045: FR-045 Find Bar
    fr_046: FR-046 Replace
    fr_047: FR-047 Search Engine
    fr_048: FR-048 UI Integration
    fr_049: FR-049 Search Performance
    # Spell Check (FR-050-054)
    fr_050: FR-050 Real-Time Spell Check
    fr_051: FR-051 Suggestions
    fr_052: FR-052 Custom Dictionary
    fr_053: FR-053 Multi-Language
    fr_054: FR-054 Performance
    # UI & UX (FR-055-061)
    fr_055: FR-055 Theme Support
    fr_056: FR-056 Status Bar
    fr_057: FR-057 Document Metrics
    fr_058: FR-058 Menu Structure
    fr_059: FR-059 Preferences Dialog
    fr_060: FR-060 Keyboard Shortcuts
    fr_061: FR-061 Accessibility
    # Performance (FR-062-068)
    fr_062: FR-062 Fast Startup
    fr_063: FR-063 Worker Pool
    fr_064: FR-064 Async I/O
    fr_065: FR-065 Lazy Loading
    fr_066: FR-066 Resource Monitor
    fr_067: FR-067 Optimized Imports
    fr_067a: FR-067a String Optimization
    fr_067b: FR-067b PDF Reading Optimization
    fr_067c: FR-067c Binary Operations
    fr_068: FR-068 Memory Management
    # Security (FR-069-072)
    fr_069: FR-069 Atomic Writes
    fr_070: FR-070 Path Sanitization
    fr_071: FR-071 Subprocess Safety
    fr_072: FR-072 Input Validation
    # Additional Features (FR-073-084)
    fr_073: FR-073 Telemetry
    fr_074: FR-074 Crash Reports
    fr_075: FR-075 Type Safety
    fr_076: FR-076 Test Coverage
    fr_077: FR-077 Documentation
    fr_078: FR-078 Help System
    fr_079: FR-079 Update Check
    fr_080: FR-080 Plugin System
    fr_081: FR-081 Custom Themes
    fr_082: FR-082 Export Presets
    fr_083: FR-083 Macro Recording
    fr_084: FR-084 LRU Cache
    # Auto-Complete (FR-085-090)
    fr_085: FR-085 Auto-Complete Engine
    fr_086: FR-086 Context Detection
    fr_087: FR-087 Completion Provider
    fr_088: FR-088 Fuzzy Matching
    fr_089: FR-089 UI Widget
    fr_090: FR-090 Performance
    # Syntax Checking (FR-091-099)
    fr_091: FR-091 Syntax Checker
    fr_092: FR-092 Error Detection
    fr_093: FR-093 Error Display
    fr_094: FR-094 Quick Fixes
    fr_095: FR-095 Navigation
    fr_096: FR-096 Real-Time Validation
    fr_097: FR-097 Rule Engine
    fr_098: FR-098 Custom Rules
    fr_099: FR-099 Performance
    # Templates (FR-100-107)
    fr_100: FR-100 Template Manager
    fr_101: FR-101 Built-In Templates
    fr_102: FR-102 Custom Templates
    fr_103: FR-103 Template Variables
    fr_104: FR-104 Template Engine
    fr_105: FR-105 UI Integration
    fr_106: FR-106 Template Browser
    fr_107: FR-107 Performance
    # Test type markers
    security: Security tests (vulnerability, injection, sanitization)
    edge_case: Edge case and boundary condition tests
    requires_gpu: Tests requiring GPU hardware and Qt WebEngine libraries (libsmime3.so)

# Minimum Python version
minversion = 3.11

# Qt/pytest-qt configuration
qt_api = pyside6
# Use offscreen platform for headless testing
# Set via: export QT_QPA_PLATFORM=offscreen

# Benchmark configuration (QA-8)
[tool:pytest]
benchmark_min_rounds = 5
benchmark_max_time = 1.0
benchmark_calibration_precision = 10
benchmark_warmup = true
benchmark_disable_gc = false
benchmark_sort = mean
