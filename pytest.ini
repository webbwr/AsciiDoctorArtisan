[pytest]
# =============================================================================
# ASCIIDOC ARTISAN TEST CONFIGURATION
# =============================================================================
#
# TEST STRATEGY: Total Coverage with Bug-Finding Focus
#
# PRINCIPAL GOAL: Bug and issue-free code
#
# Tests exist to FIND BUGS, not to pass. A passing test suite with bugs
# in production is a failure. Tests should:
#   1. Cover ALL code paths (target: 95%+ line coverage)
#   2. Cover ALL UI interactions and edge cases
#   3. Actively seek bugs through property-based testing
#   4. Validate security, performance, and correctness
#   5. Fail loudly when something is wrong
#
# =============================================================================

# Minimum version
minversion = 7.0

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Default options - MAXIMIZED FOR BUG DETECTION
addopts =
    -ra
    --strict-markers
    --strict-config
    --showlocals
    --tb=long
    --timeout=30
    --timeout_method=thread
    --cov=src/asciidoc_artisan
    --cov-report=term-missing
    --cov-report=html:coverage_html
    --cov-fail-under=90

# Strict xfail - tests marked xfail MUST actually fail
xfail_strict = true

# Warnings configuration - catch ALL warnings to find issues
filterwarnings =
    error
    ignore::DeprecationWarning:keyring.*
    ignore::DeprecationWarning:jeepney.*
    ignore::DeprecationWarning:pkg_resources.*
    ignore::DeprecationWarning:google.*
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    ignore::pytest.PytestUnknownMarkWarning
    ignore::ResourceWarning
    ignore:Pdb:UserWarning

# Test paths
testpaths = tests

# Enable doctest modules for additional testing
doctest_optionflags = ELLIPSIS NORMALIZE_WHITESPACE

# Fail on empty parameter sets (catches broken parametrized tests)
empty_parameter_set_mark = fail_at_collect

# =============================================================================
# COVERAGE CONFIGURATION
# =============================================================================
# Coverage must be maintained at 90%+ to ensure bug-free code
# Uncovered code is potential bug territory

[coverage:run]
branch = true
source = src/asciidoc_artisan
omit =
    */tests/*
    */__pycache__/*
    */migrations/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
    if TYPE_CHECKING:
    if __name__ == .__main__.:
    @abstractmethod
show_missing = true
precision = 2

# Markers - FR (Functional Requirement) associations
markers =
    # Core Editing FRs (FR-001-020)
    fr_001: FR-001 Text Editor - Main text editing component
    fr_002: FR-002 Line Numbers - Line number display
    fr_003: FR-003 Undo/Redo - Undo/redo functionality
    fr_004: FR-004 Font Customization - Font settings
    fr_005: FR-005 Editor State - Editor state management
    fr_006: FR-006 Open Files - File opening operations
    fr_007: FR-007 Save Files - File saving operations (CRITICAL)
    fr_008: FR-008 Save As - Save as operations
    fr_009: FR-009 New Document - New document creation
    fr_010: FR-010 Recent Files - Recent files tracking
    fr_011: FR-011 Auto-Save - Auto-save functionality
    fr_012: FR-012 Import DOCX - DOCX import
    fr_013: FR-013 Import PDF - PDF import
    fr_014: FR-014 Import Markdown - Markdown import
    fr_015: FR-015 Live Preview - Live preview rendering
    fr_016: FR-016 GPU Acceleration - GPU-accelerated rendering
    fr_017: FR-017 Scroll Sync - Scroll synchronization
    fr_018: FR-018 Incremental Render - Incremental rendering
    fr_019: FR-019 Debounce - Debounce mechanism
    fr_020: FR-020 Preview Themes - Preview theme support

    # Export & Conversion (FR-021-025)
    fr_021: FR-021 Export HTML - HTML export
    fr_022: FR-022 Export PDF - PDF export
    fr_023: FR-023 Export DOCX - DOCX export
    fr_024: FR-024 Export Markdown - Markdown export
    fr_025: FR-025 AI Export Enhancement - AI-enhanced export

    # Git Integration (FR-026-033)
    fr_026: FR-026 Select Repository - Repository selection
    fr_027: FR-027 Git Commit - Git commit operations
    fr_028: FR-028 Git Pull - Git pull operations
    fr_029: FR-029 Git Push - Git push operations
    fr_030: FR-030 Git Status Bar - Git status bar indicator
    fr_031: FR-031 Git Status Dialog - Git status dialog
    fr_032: FR-032 Quick Commit - Quick commit widget
    fr_033: FR-033 Cancel Git Operations - Git operation cancellation

    # GitHub CLI (FR-034-038)
    fr_034: FR-034 Create PR - Create pull request
    fr_035: FR-035 List PRs - List pull requests
    fr_036: FR-036 Create Issue - Create issue
    fr_037: FR-037 List Issues - List issues
    fr_038: FR-038 View Repo - View repository

    # AI Features (FR-039-044)
    fr_039: FR-039 Ollama Chat Panel - Ollama chat panel
    fr_040: FR-040 Chat Modes - Ollama chat modes
    fr_041: FR-041 Model Selection - Ollama model selection
    fr_042: FR-042 Chat History - Ollama chat history
    fr_043: FR-043 Ollama Integration - Ollama integration
    fr_044: FR-044 Status Indicator - Ollama status indicator

    # Find & Replace (FR-045-049)
    fr_045: FR-045 Find Bar - Find bar widget
    fr_046: FR-046 Replace - Replace functionality
    fr_047: FR-047 Search Engine - Search engine
    fr_048: FR-048 UI Integration - Find/replace UI integration
    fr_049: FR-049 Search Performance - Search performance

    # Spell Check (FR-050-054)
    fr_050: FR-050 Real-Time Spell Check - Real-time spell checking
    fr_051: FR-051 Suggestions - Spell check suggestions
    fr_052: FR-052 Custom Dictionary - Custom dictionary
    fr_053: FR-053 Multi-Language - Multi-language spell check
    fr_054: FR-054 Performance - Spell check performance

    # UI Components (FR-055-061)
    fr_055: FR-055 Dark Mode - Dark mode theme
    fr_056: FR-056 Zoom Controls - Zoom in/out controls
    fr_057: FR-057 Status Bar - Status bar component
    fr_058: FR-058 Toolbar - Toolbar component
    fr_059: FR-059 Menu Bar - Menu bar component
    fr_060: FR-060 Dialog Manager - Dialog management
    fr_061: FR-061 Error Display - Error display handling

    # Performance (FR-062-068)
    fr_062: FR-062 Fast Startup - Fast application startup
    fr_063: FR-063 Worker Pool - Worker thread pool
    fr_064: FR-064 Async I/O - Asynchronous I/O operations
    fr_065: FR-065 Resource Monitoring - Resource monitoring
    fr_066: FR-066 Memory Optimization - Memory optimization
    fr_067: FR-067 Cache Strategy - Caching strategy
    fr_068: FR-068 Path Sanitization (legacy) - Legacy path marker

    # Security (FR-069-072) - CRITICAL
    fr_069: FR-069 Atomic Writes - Atomic file writes (CRITICAL)
    fr_070: FR-070 Path Sanitization - Path sanitization (CRITICAL)
    fr_071: FR-071 Subprocess Safety - Subprocess safety (CRITICAL)
    fr_072: FR-072 Input Validation - Input validation (CRITICAL)

    # Additional Features (FR-073-084)
    fr_073: FR-073 Telemetry - Telemetry collection
    fr_074: FR-074 Settings Persistence - Settings persistence

    # Additional markers for FR categories
    fr_075: FR-075 Type Safety - Type safety with mypy
    fr_076: FR-076 Test Coverage - Test coverage requirements

    # Syntax Checking (FR-077-084)
    fr_077: FR-077 Syntax Checker - Syntax validation
    fr_078: FR-078 Error Navigation - Error navigation
    fr_079: FR-079 Syntax Markers - Syntax error markers
    fr_080: FR-080 Syntax Performance - Syntax check performance
    fr_081: FR-081 Syntax Cache - Syntax cache
    fr_082: FR-082 Syntax Rules - Syntax rules engine
    fr_083: FR-083 Syntax Models - Syntax data models
    fr_084: FR-084 Syntax Validators - Syntax validators

    # Autocomplete (FR-085-097)
    fr_085: FR-085 Autocomplete Engine - Autocomplete engine
    fr_086: FR-086 Autocomplete Trigger - Autocomplete trigger
    fr_087: FR-087 Autocomplete Providers - Autocomplete providers
    fr_088: FR-088 Autocomplete Cache - Autocomplete cache
    fr_089: FR-089 Autocomplete Performance - Autocomplete performance
    fr_090: FR-090 Autocomplete UI - Autocomplete UI integration
    fr_091: FR-091 Autocomplete Context - Autocomplete context
    fr_092: FR-092 Autocomplete Snippets - Snippet expansion
    fr_093: FR-093 Autocomplete Symbols - Symbol completion
    fr_094: FR-094 Autocomplete History - Autocomplete history
    fr_095: FR-095 Autocomplete Ranking - Completion ranking
    fr_096: FR-096 Autocomplete Fuzzy - Fuzzy matching
    fr_097: FR-097 Autocomplete Selection - Selection handling

    # Templates (FR-098-107)
    fr_098: FR-098 Template Engine - Template rendering engine
    fr_099: FR-099 Template Parser - Template parsing
    fr_100: FR-100 Template Manager - Template management
    fr_101: FR-101 Template Persistence - Template storage
    fr_102: FR-102 Template Categories - Template categorization
    fr_103: FR-103 Template Variables - Variable substitution
    fr_104: FR-104 Template Validation - Template validation
    fr_105: FR-105 Template Recent - Recent templates
    fr_106: FR-106 Template Export - Template export
    fr_107: FR-107 Template Import - Template import

    # LSP (FR-108+)
    fr_108: FR-108 LSP Server - Language Server Protocol

    # Test type classification
    property: Property-based test - Tests with randomized inputs
    unit: Unit test - Tests individual functions/methods
    integration: Integration test - Tests component interactions
    e2e: End-to-end test - Tests full user workflows
    security: Security test - Tests security requirements
    performance: Performance test - Tests performance requirements
    edge_case: Edge case test - Tests boundary conditions

    # Test environment requirements
    requires_gpu: Test requires GPU (Qt WebEngine)
    live_api: Test requires live API service (Ollama)
    slow: Test takes >5 seconds to run
