# v1.8.0 Essential Features - Implementation Plan

**Created:** November 2, 2025
**Status:** PLANNING
**Target Release:** Q1-Q2 2026 (March-June 2026)
**Total Effort:** 24-36 hours

---

## Executive Summary

v1.8.0 "Essential Features" focuses on completing fundamental editor capabilities that users expect from a professional document editor. The three core features are Find/Replace, Telemetry (opt-in), and Spell Checker integration.

**Key Principle:** Prioritize user-requested features that provide immediate value.

---

## Scope Clarification

### Tasks Moved from v1.7.0 to v1.8.0

The following tasks were originally planned for v1.7.0 but deferred to v1.8.0:

1. **Find & Replace System** (moved from v1.7.0 Task 1)
2. **Telemetry System** (moved from v1.7.0 Task 2)
3. **Spell Checker Integration** (always planned for v1.8.0)

**Reason for deferral:** v1.7.0 focused exclusively on Ollama AI Chat integration (36-45 hours actual effort), which was added as a priority after the original v1.7.0 plan was created.

### Confirmed v1.8.0 Tasks

Based on ROADMAP.md Quick Reference (line 18):

| Task | Priority | Effort | Status |
|------|----------|--------|--------|
| Find & Replace System | HIGH | 8-12h | üìã Pending |
| Telemetry System (opt-in) | MEDIUM | 16-24h | üìã Pending |
| Spell Checker Integration | HIGH | 12-16h | üìã Pending (moved from v1.7.0) |

**Total:** 36-52 hours (within ROADMAP estimate of 24-36h base + minor tasks)

---

## Task 1: Find & Replace System ‚≠ê

**Priority:** HIGH | **Effort:** 8-12 hours | **Status:** üìã Planning

### User Stories

1. As a user, I want to find text in my document with Ctrl+F
2. As a user, I want to replace text with Ctrl+H
3. As a user, I want regex search for advanced patterns
4. As a user, I want case-sensitive/insensitive options
5. As a user, I want to preview replacements before applying

### Features

**Find:**
- Quick find (Ctrl+F) with incremental search
- Find next/previous navigation
- Case-sensitive toggle
- Whole word matching toggle
- Regular expression support
- Highlight all matches
- Match count display

**Replace:**
- Replace dialog (Ctrl+H)
- Replace single occurrence
- Replace all occurrences
- Replace in selection
- Preview before replace (confirmation dialog)
- Undo support for replacements

### Technical Design

**New Files:**

1. **`src/asciidoc_artisan/ui/find_replace_dialog.py`** (~300 lines)
   - QDialog with two modes: Find and Replace
   - Input fields for search/replace text
   - Checkboxes for options (case, whole word, regex)
   - Buttons: Find Next, Find Previous, Replace, Replace All
   - Match count label
   - Integration with QPlainTextEdit

2. **`src/asciidoc_artisan/core/search_engine.py`** (~200 lines)
   - `SearchEngine` class with search/replace logic
   - Regex compilation and validation
   - Match highlighting logic
   - Replace preview generation
   - Thread-safe for background search

3. **`tests/test_find_replace_dialog.py`** (~150 lines)
   - Dialog creation and UI tests
   - Search interaction tests
   - Replace operation tests

4. **`tests/test_search_engine.py`** (~200 lines)
   - Search algorithm tests (case-sensitive, whole word, regex)
   - Replace logic tests (single, all, in selection)
   - Edge case tests (empty, overlapping matches)

### Integration Points

**Modified Files:**
- `src/asciidoc_artisan/ui/main_window.py` - Add find/replace actions
- `src/asciidoc_artisan/ui/menu_manager.py` - Add Edit menu items
- `src/asciidoc_artisan/ui/action_manager.py` - Create QAction instances
- `src/asciidoc_artisan/ui/line_number_area.py` - Add highlight support

### Success Criteria

- ‚úÖ Ctrl+F opens Find dialog
- ‚úÖ Ctrl+H opens Replace dialog
- ‚úÖ Incremental search works (<50ms response)
- ‚úÖ All matches highlighted in editor
- ‚úÖ Regex patterns supported
- ‚úÖ Replace preview shown before execution
- ‚úÖ Undo works for replacements
- ‚úÖ 25+ tests pass with 100% coverage

### Risks & Mitigation

| Risk | Mitigation |
|------|------------|
| Performance with large documents (10,000+ lines) | Implement incremental search, limit highlight count |
| Complex regex crashes | Timeout regex compilation, validate patterns |
| Undo integration complexity | Use QPlainTextEdit built-in undo stack |

---

## Task 2: Telemetry System (Opt-In) ‚≠ê

**Priority:** MEDIUM | **Effort:** 16-24 hours | **Status:** üìã Planning

### User Stories

1. As a developer, I want to understand which features users use most
2. As a developer, I want crash reports to fix bugs faster
3. As a user, I want full control over data sharing (opt-in)
4. As a user, I want to know exactly what data is collected

### Features

**Data Collection (with explicit opt-in):**
- Feature usage frequency (menu clicks, dialog opens, shortcuts used)
- Crash reports (exception stack traces only, no document content)
- Performance metrics (startup time, render latency, memory usage)
- Error patterns (error types, frequency, context)
- System info (OS, Python version, Qt version, GPU type)

**Privacy Requirements:**
- ‚ùå NO personal data (names, emails, IP addresses)
- ‚ùå NO document content (text, file paths, metadata)
- ‚ùå NO identifying information
- ‚úÖ Anonymous session IDs only
- ‚úÖ GDPR compliant
- ‚úÖ Clear opt-in on first launch
- ‚úÖ Easy opt-out anytime

### Technical Design

**New Files:**

1. **`src/asciidoc_artisan/core/telemetry.py`** (~300 lines)
   - `TelemetryManager` class (singleton)
   - Event tracking API: `track_event(event_name, properties)`
   - Crash reporting: `report_exception(exception, context)`
   - Performance tracking: `track_timing(metric_name, duration)`
   - Session management: `start_session()`, `end_session()`
   - Async upload to telemetry backend (queue + worker thread)

2. **`src/asciidoc_artisan/ui/telemetry_dialog.py`** (~200 lines)
   - Opt-in dialog shown on first launch
   - Clear explanation of what data is collected
   - Link to full privacy policy
   - Toggle to enable/disable telemetry
   - Accessible via Settings ‚Üí Privacy

3. **`tests/test_telemetry.py`** (~250 lines)
   - Event tracking tests
   - Privacy compliance tests (no PII sent)
   - Opt-in/opt-out tests
   - Crash reporting tests
   - Queue and upload tests

### Integration Points

**Modified Files:**
- `src/asciidoc_artisan/core/settings.py` - Add telemetry settings
- `src/asciidoc_artisan/ui/main_window.py` - Show opt-in dialog on first launch
- `src/asciidoc_artisan/ui/settings_manager.py` - Add Privacy section
- `src/main.py` - Initialize telemetry, wrap main() with error handler

**Dependency:**
- `sentry-sdk` (optional dependency, only installed if user opts in)

### Backend Options

**Option 1: Sentry (Recommended)**
- Free tier: 5,000 events/month
- Built-in crash reporting
- Performance monitoring
- Privacy-focused (GDPR compliant)
- Easy integration with `sentry-sdk`

**Option 2: Self-hosted (Future)**
- Full control over data
- No external dependencies
- Requires server infrastructure
- More complex setup

**Decision:** Start with Sentry for simplicity, migrate to self-hosted if needed.

### Success Criteria

- ‚úÖ Opt-in dialog shown on first launch
- ‚úÖ Clear explanation of data collection
- ‚úÖ Telemetry can be enabled/disabled in Settings
- ‚úÖ No PII sent (verified with tests)
- ‚úÖ Crash reports include stack traces only
- ‚úÖ Feature usage tracked correctly
- ‚úÖ 30+ tests pass with 100% coverage

### Risks & Mitigation

| Risk | Mitigation |
|------|------------|
| Privacy concerns | Clear opt-in, no PII, open source code |
| Negative user perception | Emphasize value (better bug fixes, feature prioritization) |
| Legal compliance (GDPR) | Use GDPR-compliant backend (Sentry), no PII |

---

## Task 3: Spell Checker Integration ‚≠ê

**Priority:** HIGH | **Effort:** 12-16 hours | **Status:** üìã Planning

### User Stories

1. As a user, I want to see spelling errors underlined in red
2. As a user, I want to right-click on errors for suggestions
3. As a user, I want to add words to a personal dictionary
4. As a user, I want to disable spell checking for code blocks

### Features

**Spell Checking:**
- Real-time spell checking (underline errors in red)
- Right-click context menu with suggestions
- Language selection (English, Spanish, French, German, etc.)
- Personal dictionary (add/remove words)
- Ignore code blocks and inline code (AsciiDoc specific)
- Ignore URLs, email addresses, file paths
- Toggle spell checking on/off

**Integration with AsciiDoc:**
- Skip spell checking in:
  - Code blocks (source, listing)
  - Inline code (monospace)
  - Attributes (`:attribute-name:`)
  - Macros (`image::`, `include::`)
  - Comments (`//`)

### Technical Design

**New Files:**

1. **`src/asciidoc_artisan/core/spell_checker.py`** (~300 lines)
   - `SpellChecker` class wrapping `pyspellchecker`
   - Language dictionary loading
   - Word validation
   - Suggestion generation
   - Personal dictionary management
   - AsciiDoc context detection (skip code, macros)

2. **`src/asciidoc_artisan/ui/spell_check_highlighter.py`** (~250 lines)
   - QSyntaxHighlighter subclass for spell checking
   - Real-time error underlining
   - Integration with QPlainTextEdit
   - Performance optimization (incremental checking)

3. **`tests/test_spell_checker.py`** (~150 lines)
   - Word validation tests
   - Suggestion generation tests
   - Personal dictionary tests
   - AsciiDoc context detection tests

4. **`tests/test_spell_check_highlighter.py`** (~100 lines)
   - Highlighting tests
   - Context menu tests
   - Performance tests

### Integration Points

**Modified Files:**
- `src/asciidoc_artisan/ui/line_number_area.py` - Add spell check highlighter
- `src/asciidoc_artisan/ui/main_window.py` - Add right-click context menu
- `src/asciidoc_artisan/ui/menu_manager.py` - Add Tools ‚Üí Spell Checking
- `src/asciidoc_artisan/ui/settings_manager.py` - Add spell checking settings
- `src/asciidoc_artisan/core/settings.py` - Add spell_check_enabled, spell_check_language

**Dependency:**
- `pyspellchecker` (pure Python, no system dependencies)

### Success Criteria

- ‚úÖ Spelling errors underlined in red
- ‚úÖ Right-click shows suggestions
- ‚úÖ Personal dictionary works (add/remove words)
- ‚úÖ Code blocks and inline code skipped
- ‚úÖ Language selection works (English, Spanish, etc.)
- ‚úÖ Toggle spell checking on/off
- ‚úÖ Performance acceptable (<100ms per edit)
- ‚úÖ 25+ tests pass with 100% coverage

### Risks & Mitigation

| Risk | Mitigation |
|------|------------|
| Performance with large documents | Incremental checking, limit check scope |
| False positives (technical terms) | Personal dictionary, ignore code context |
| Language support | Use `pyspellchecker` with downloadable dictionaries |

---

## Implementation Order

### Phase 1: Core Features (16-28 hours)

**Week 1-2:**
1. Find & Replace System (8-12h)
   - Implement SearchEngine
   - Create FindReplaceDialog
   - Write tests (25 tests)
   - Integration with main_window

**Week 3:**
2. Spell Checker Integration (12-16h)
   - Implement SpellChecker
   - Create SpellCheckHighlighter
   - Add context menu
   - Write tests (25 tests)

### Phase 2: Telemetry & Polish (20-24 hours)

**Week 4-5:**
3. Telemetry System (16-24h)
   - Implement TelemetryManager
   - Create TelemetryDialog
   - Integrate with main_window
   - Write tests (30 tests)
   - Set up Sentry backend

**Week 6:**
4. Testing & Bug Fixes (4h)
   - Full integration testing
   - Fix issues from user testing
   - Update documentation

### Total Timeline: 6 weeks (36-52 hours)

---

## Testing Strategy

### Test Coverage Goals

| Component | Target Coverage | Test Count |
|-----------|----------------|------------|
| Find/Replace | 100% | 25 tests |
| Spell Checker | 100% | 25 tests |
| Telemetry | 100% | 30 tests |
| Integration | 95%+ | 10 tests |
| **Total** | **100%** | **90 tests** |

### Test Categories

1. **Unit Tests** - Core logic (search, spell check, telemetry)
2. **UI Tests** - Dialog interactions, menu actions
3. **Integration Tests** - End-to-end workflows
4. **Performance Tests** - Large documents, regex complexity
5. **Privacy Tests** - No PII sent in telemetry

---

## Documentation Deliverables

### User Documentation

1. **docs/user/FIND_REPLACE_GUIDE.md** (~500 lines)
   - How to use Find & Replace
   - Regex patterns guide
   - Keyboard shortcuts

2. **docs/user/SPELL_CHECK_GUIDE.md** (~400 lines)
   - How to use spell checking
   - Language selection
   - Personal dictionary management

3. **docs/user/PRIVACY_POLICY.md** (~600 lines)
   - What data is collected
   - How data is used
   - Opt-in/opt-out instructions

### Developer Documentation

4. **docs/dev/TELEMETRY_ARCHITECTURE.md** (~500 lines)
   - Telemetry design
   - Event tracking API
   - Privacy safeguards

---

## Success Criteria (Overall)

| Criterion | Target | Priority | Status |
|-----------|--------|----------|--------|
| Find & Replace working | ‚úÖ Yes | CRITICAL | üìã Pending |
| Spell checking active | ‚úÖ Yes | HIGH | üìã Pending |
| Telemetry opt-in | ‚úÖ Yes | MEDIUM | üìã Pending |
| Test coverage | 100% | HIGH | üìã Pending |
| All 90+ tests passing | ‚úÖ Yes | CRITICAL | üìã Pending |
| User docs complete | ‚úÖ Yes | HIGH | üìã Pending |
| Zero critical bugs | ‚úÖ Yes | CRITICAL | üìã Pending |
| Performance maintained | <1.1s startup | MEDIUM | üìã Pending |

---

## Release Checklist

**Pre-release:**
- [ ] All 90+ tests passing
- [ ] 100% test coverage verified
- [ ] User documentation complete
- [ ] Privacy policy reviewed (legal)
- [ ] Sentry backend configured
- [ ] Performance benchmarked (<1.1s startup)

**Release:**
- [ ] Update version: 1.7.0 ‚Üí 1.8.0 (pyproject.toml)
- [ ] Update CHANGELOG.md
- [ ] Update README.md (new features)
- [ ] Git tag: v1.8.0
- [ ] GitHub release notes

**Post-release:**
- [ ] Monitor telemetry data
- [ ] Track user feedback
- [ ] Fix critical bugs (hotfix 1.8.1 if needed)

---

## Next Steps (Immediate)

1. ‚úÖ Complete this implementation plan
2. üìã Update ROADMAP.md to clarify v1.7.0/v1.8.0 task movement
3. üìã Begin Find & Replace implementation (Task 1)
4. üìã Set up project structure for new files

---

**Plan Status:** ‚úÖ COMPLETE
**Ready to begin:** Task 1 (Find & Replace System)
**Last Updated:** November 2, 2025
