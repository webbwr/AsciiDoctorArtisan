# v2.0.0 Integration Guide

**Version:** 2.0.0
**Created:** November 8, 2025
**Status:** ðŸš§ IMPLEMENTATION (Phase 3 Complete, Integration Pending)

---

## Overview

This guide shows how to integrate v2.0.0 features (Auto-Complete, Syntax Checking, Templates) into the main application.

**Phase 3 Deliverables (âœ… COMPLETE):**
- `ui/autocomplete_widget.py` - Popup completion list widget
- `ui/autocomplete_manager.py` - Auto-complete coordination
- `ui/syntax_checker_manager.py` - Error underlines and navigation
- `ui/template_browser.py` - Template selection dialog

**Integration Status:** Ready for integration into `main_window.py`

---

## Integration Steps

### Step 1: Add Settings

Add v2.0.0 settings to `core/settings.py`:

```python
# Auto-Complete Settings
"autocomplete_enabled": True,
"autocomplete_delay": 300,  # ms
"autocomplete_min_chars": 2,

# Syntax Checking Settings
"syntax_check_enabled": True,
"syntax_check_delay": 500,  # ms
"syntax_check_show_underlines": True,

# Template Settings
"template_last_category": "All",
"template_recent_limit": 10,
```

### Step 2: Initialize Managers in Main Window

Add to `ui/main_window.py` `__init__` method:

```python
from asciidoc_artisan.ui.autocomplete_manager import AutoCompleteManager
from asciidoc_artisan.ui.syntax_checker_manager import SyntaxCheckerManager
from asciidoc_artisan.core.autocomplete_engine import AutoCompleteEngine
from asciidoc_artisan.core.syntax_checker import SyntaxChecker
from asciidoc_artisan.core.template_manager import TemplateManager
from asciidoc_artisan.core.template_engine import TemplateEngine

# In __init__ after other managers:

# Auto-Complete
self.autocomplete_engine = AutoCompleteEngine()
self._setup_autocomplete_providers()
self.autocomplete_manager = AutoCompleteManager(
    self.editor,
    self.autocomplete_engine
)
self.autocomplete_manager.enabled = settings.get("autocomplete_enabled", True)
self.autocomplete_manager.auto_delay = settings.get("autocomplete_delay", 300)
self.autocomplete_manager.min_chars = settings.get("autocomplete_min_chars", 2)

# Syntax Checking
self.syntax_checker = SyntaxChecker()
self.syntax_checker_manager = SyntaxCheckerManager(
    self.editor,
    self.syntax_checker
)
self.syntax_checker_manager.enabled = settings.get("syntax_check_enabled", True)
self.syntax_checker_manager.check_delay = settings.get("syntax_check_delay", 500)

# Templates
self.template_engine = TemplateEngine()
self.template_manager = TemplateManager(self.template_engine)

# Connect signals
self.syntax_checker_manager.errors_changed.connect(
    self._on_syntax_errors_changed
)
```

### Step 3: Setup Auto-Complete Providers

Add helper method to `main_window.py`:

```python
def _setup_autocomplete_providers(self) -> None:
    """Setup auto-complete providers."""
    from asciidoc_artisan.core.autocomplete_providers import (
        SyntaxProvider,
        AttributeProvider,
        CrossRefProvider,
        IncludeProvider,
        SnippetProvider,
    )

    # Add providers in priority order
    self.autocomplete_engine.add_provider(SyntaxProvider())
    self.autocomplete_engine.add_provider(AttributeProvider())
    self.autocomplete_engine.add_provider(CrossRefProvider())
    self.autocomplete_engine.add_provider(IncludeProvider())
    self.autocomplete_engine.add_provider(SnippetProvider())
```

### Step 4: Add Actions to Action Manager

Add to `ui/action_manager.py` `create_actions()` method:

```python
# === EDIT MENU ACTIONS (add to existing) ===

# Trigger auto-complete manually (Ctrl+Space)
self.autocomplete_act = self._create_action(
    "Trigger Auto-Complete",
    "Show completion suggestions",
    self.window.trigger_autocomplete,
    shortcut="Ctrl+Space",
)

# Jump to next syntax error (F8)
self.next_error_act = self._create_action(
    "Next Error",
    "Jump to next syntax error",
    self.window.jump_to_next_error,
    shortcut="F8",
)

# Jump to previous syntax error (Shift+F8)
self.prev_error_act = self._create_action(
    "Previous Error",
    "Jump to previous syntax error",
    self.window.jump_to_previous_error,
    shortcut="Shift+F8",
)

# === FILE MENU ACTIONS (add after New) ===

# New from template
self.new_from_template_act = self._create_action(
    "New from &Template...",
    "Create new document from template",
    self.window.new_from_template,
    shortcut="Ctrl+Shift+N",
)
```

### Step 5: Add Menu Items

Add to `ui/action_manager.py` `create_menus()` method:

```python
# File menu - add after "New"
file_menu.addAction(self.new_act)
file_menu.addAction(self.new_from_template_act)  # NEW

# Edit menu - add new section
edit_menu.addSeparator()
edit_menu.addAction(self.autocomplete_act)  # NEW
edit_menu.addAction(self.next_error_act)  # NEW
edit_menu.addAction(self.prev_error_act)  # NEW
```

### Step 6: Add Handler Methods

Add to `ui/main_window.py`:

```python
def trigger_autocomplete(self) -> None:
    """Trigger auto-complete manually (Ctrl+Space)."""
    self.autocomplete_manager.trigger_manual()

def jump_to_next_error(self) -> None:
    """Jump to next syntax error (F8)."""
    self.syntax_checker_manager.jump_to_next_error()

def jump_to_previous_error(self) -> None:
    """Jump to previous syntax error (Shift+F8)."""
    self.syntax_checker_manager.jump_to_previous_error()

def new_from_template(self) -> None:
    """Create new document from template."""
    from asciidoc_artisan.ui.template_browser import TemplateBrowser

    browser = TemplateBrowser(self.template_manager, self)
    if browser.exec():
        template = browser.selected_template
        variables = browser.variable_values

        if template:
            # Instantiate template
            content = self.template_engine.instantiate(template, variables)

            # Set editor content
            self.editor.setPlainText(content)

            # Mark as unsaved
            self.current_file = None
            self.setWindowModified(True)
            self.update_title()

            # Add to recent
            self.template_manager.add_to_recent(template.name)

def _on_syntax_errors_changed(self, count: int) -> None:
    """Handle syntax error count change."""
    if count > 0:
        self.status_manager.show_message(
            f"{count} syntax error{'s' if count != 1 else ''} found",
            timeout=5000
        )
```

### Step 7: Add Preferences UI

Add to `ui/dialogs.py` preferences dialog:

```python
# In PreferencesDialog, add new tab:

# Auto-Complete tab
autocomplete_tab = QWidget()
autocomplete_layout = QVBoxLayout(autocomplete_tab)

# Enable checkbox
self.autocomplete_enabled_cb = QCheckBox("Enable auto-complete")
self.autocomplete_enabled_cb.setChecked(
    settings.get("autocomplete_enabled", True)
)
autocomplete_layout.addWidget(self.autocomplete_enabled_cb)

# Delay spinbox
delay_layout = QHBoxLayout()
delay_layout.addWidget(QLabel("Auto-complete delay (ms):"))
self.autocomplete_delay_spin = QSpinBox()
self.autocomplete_delay_spin.setRange(100, 2000)
self.autocomplete_delay_spin.setValue(settings.get("autocomplete_delay", 300))
delay_layout.addWidget(self.autocomplete_delay_spin)
autocomplete_layout.addLayout(delay_layout)

# Min chars spinbox
chars_layout = QHBoxLayout()
chars_layout.addWidget(QLabel("Minimum characters:"))
self.autocomplete_min_chars_spin = QSpinBox()
self.autocomplete_min_chars_spin.setRange(1, 5)
self.autocomplete_min_chars_spin.setValue(
    settings.get("autocomplete_min_chars", 2)
)
chars_layout.addWidget(self.autocomplete_min_chars_spin)
autocomplete_layout.addLayout(chars_layout)

autocomplete_layout.addStretch()
tabs.addTab(autocomplete_tab, "Auto-Complete")

# Syntax Checking tab
syntax_tab = QWidget()
syntax_layout = QVBoxLayout(syntax_tab)

# Enable checkbox
self.syntax_check_enabled_cb = QCheckBox("Enable syntax checking")
self.syntax_check_enabled_cb.setChecked(
    settings.get("syntax_check_enabled", True)
)
syntax_layout.addWidget(self.syntax_check_enabled_cb)

# Delay spinbox
delay_layout = QHBoxLayout()
delay_layout.addWidget(QLabel("Check delay (ms):"))
self.syntax_check_delay_spin = QSpinBox()
self.syntax_check_delay_spin.setRange(100, 5000)
self.syntax_check_delay_spin.setValue(settings.get("syntax_check_delay", 500))
delay_layout.addWidget(self.syntax_check_delay_spin)
syntax_layout.addLayout(delay_layout)

# Show underlines checkbox
self.syntax_show_underlines_cb = QCheckBox("Show error underlines")
self.syntax_show_underlines_cb.setChecked(
    settings.get("syntax_check_show_underlines", True)
)
syntax_layout.addWidget(self.syntax_show_underlines_cb)

syntax_layout.addStretch()
tabs.addTab(syntax_tab, "Syntax Checking")

# In save_settings() method:
settings.set("autocomplete_enabled", self.autocomplete_enabled_cb.isChecked())
settings.set("autocomplete_delay", self.autocomplete_delay_spin.value())
settings.set("autocomplete_min_chars", self.autocomplete_min_chars_spin.value())

settings.set("syntax_check_enabled", self.syntax_check_enabled_cb.isChecked())
settings.set("syntax_check_delay", self.syntax_check_delay_spin.value())
settings.set("syntax_check_show_underlines",
             self.syntax_show_underlines_cb.isChecked())

# Apply settings to managers
main_window = self.parent()
main_window.autocomplete_manager.enabled = settings.get("autocomplete_enabled")
main_window.autocomplete_manager.auto_delay = settings.get("autocomplete_delay")
main_window.autocomplete_manager.min_chars = settings.get("autocomplete_min_chars")

main_window.syntax_checker_manager.enabled = settings.get("syntax_check_enabled")
main_window.syntax_checker_manager.check_delay = settings.get("syntax_check_delay")
main_window.syntax_checker_manager.show_underlines = settings.get(
    "syntax_check_show_underlines"
)
```

---

## Testing Integration

After integrating, test each feature:

### Auto-Complete

1. Type `=` and wait 300ms â†’ Should show heading completions
2. Press `Ctrl+Space` â†’ Should show all completions immediately
3. Use arrow keys to navigate â†’ Should highlight items
4. Press Enter â†’ Should insert completion text
5. Press Escape â†’ Should hide popup

### Syntax Checking

1. Type `[source]` without closing â†’ Should show red squiggly line
2. Hover over error â†’ Should show error message tooltip
3. Press F8 â†’ Should jump to error position
4. Press Shift+F8 â†’ Should jump to previous error
5. Fix error â†’ Underline should disappear after 500ms

### Templates

1. File â†’ New from Template â†’ Should open browser dialog
2. Select "Article" template â†’ Should show variable dialog
3. Fill in Title, Author â†’ Should create new document
4. Check recent templates â†’ "Article" should appear

---

## Performance Validation

After integration, verify performance budgets:

```bash
# Auto-complete performance
python scripts/benchmark_autocomplete.py
# Expected: <50ms for 1000 items

# Syntax checking performance
python scripts/benchmark_syntax_checking.py
# Expected: <100ms for 1000-line document

# Template instantiation
python scripts/benchmark_templates.py
# Expected: <50ms template instantiation
```

---

## Rollback Plan

If integration causes issues, features can be disabled:

```python
# In settings.py defaults
"autocomplete_enabled": False,
"syntax_check_enabled": False,
```

Or remove from UI by commenting out:
- Manager initialization in `main_window.py`
- Actions in `action_manager.py`
- Menu items in `create_menus()`

---

## Next Steps

1. âœ… Phase 1: Core engines complete
2. âœ… Phase 2: Providers and validators complete
3. âœ… Phase 3: Qt UI widgets complete
4. ðŸ“‹ Phase 4: Integration (use this guide)
5. ðŸ“‹ Phase 5: Testing (85+ integration tests)
6. ðŸ“‹ Phase 6: Documentation update

---

## Support

For questions about integration:
- See `CLAUDE.md` for architecture overview
- See `v2.0.0_*.md` files for detailed feature specs
- Run tests: `pytest tests/unit/ui/test_autocomplete_*.py -v`
