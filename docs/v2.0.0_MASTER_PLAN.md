# v2.0.0 Master Implementation Plan

**Version:** 2.0.0 - Advanced Editing
**Target Release:** Q2-Q3 2026
**Estimated Effort:** 102-160 hours (16 weeks)
**Created:** November 8, 2025
**Status:** ðŸ“‹ PLANNING â†’ ðŸš§ IMPLEMENTATION

---

## Executive Summary

v2.0.0 adds three critical advanced editing features to AsciiDoc Artisan:

1. **Auto-Complete System** - Smart syntax completion with fuzzy matching
2. **Syntax Error Detection** - Real-time validation with quick fixes
3. **Document Templates** - Built-in and custom templates with live preview

These features transform AsciiDoc Artisan from a basic editor into a professional technical writing environment.

---

## Table of Contents

1. [Goals and Objectives](#goals-and-objectives)
2. [Implementation Phases](#implementation-phases)
3. [Feature Details](#feature-details)
4. [Architecture Overview](#architecture-overview)
5. [Test Strategy](#test-strategy)
6. [Performance Requirements](#performance-requirements)
7. [Success Criteria](#success-criteria)
8. [Risk Management](#risk-management)
9. [Timeline and Milestones](#timeline-and-milestones)

---

## Goals and Objectives

### Primary Goals

1. **Productivity** - Reduce time to write AsciiDoc by 40%+
2. **Quality** - Catch syntax errors before preview
3. **Ease of Use** - Templates for common document types
4. **Performance** - Maintain <1.1s startup time

### User Benefits

- **New Users:** Templates and syntax checking reduce learning curve
- **Power Users:** Auto-complete speeds up complex document creation
- **Teams:** Templates ensure consistent document structure

---

## Implementation Phases

### Phase 1: Foundation (Weeks 1-4, 29-35h)

**Goal:** Build core engines with basic functionality

**Deliverables:**
- `core/autocomplete_engine.py` - Completion matching and ranking
- `core/syntax_checker.py` - Error detection and cataloging
- `core/template_engine.py` - Template loading and variable substitution
- Data models: `CompletionItem`, `SyntaxError`, `Template`
- 140+ unit tests

**Success Criteria:**
- All core engines pass unit tests
- <50ms completion matching for 1000 items
- <100ms syntax check for 1000-line document
- <50ms template instantiation

### Phase 2: Feature Completion (Weeks 5-8, 27-33h)

**Goal:** Complete backend logic and providers

**Deliverables:**
- Auto-complete providers: Syntax, Attributes, Cross-refs, Includes
- Syntax checkers: Semantic, Style, Best Practices
- Template manager with CRUD operations
- 170+ tests total (30+ new integration tests)

**Success Criteria:**
- 100+ completion items for AsciiDoc syntax
- 50+ error rules (E001-E050, W001-W050, I001-I050)
- 8 built-in templates ready
- All providers integrated with core engines

### Phase 3: UI Integration (Weeks 9-12, 30-37h)

**Goal:** Qt integration with polished UX

**Deliverables:**
- `ui/autocomplete_widget.py` - Popup completion list
- `ui/syntax_checker_manager.py` - Error underlines and gutter icons
- `ui/template_browser.py` - Template selection dialog
- Settings integration for all features
- Keyboard shortcuts (Ctrl+Space, F8, etc.)
- 200+ tests total (30+ new Qt tests)

**Success Criteria:**
- Auto-complete shows on Ctrl+Space
- Syntax errors update in real-time (<500ms after typing stops)
- Template browser shows preview
- All features configurable via Settings

### Phase 4: Polish & Release (Weeks 13-16, 16-25h)

**Goal:** Production-ready with comprehensive docs

**Deliverables:**
- Snippet expansion for auto-complete
- Quick fixes (lightbulb UI) for syntax errors
- 8 built-in templates (article, book, man page, report, README, notes, tutorial, API docs)
- User documentation (20 pages)
- Tutorial videos (optional)
- 280+ tests total (80+ new feature tests)

**Success Criteria:**
- 100% test pass rate
- Documentation complete
- Performance budgets met
- Zero critical bugs

---

## Feature Details

### 1. Auto-Complete System

**Core Capabilities:**
- **Syntax Completion:** Headings (= to =====), lists (*, -, .), blocks ([source], [example])
- **Attribute Completion:** `:author:`, `:version:`, custom attributes
- **Cross-Reference Completion:** `<<target>>` with fuzzy search
- **Include Completion:** `include::path[]` with filesystem search
- **Snippet Expansion:** Expand `tab` to tables, `fig` to figures

**UI:**
- Popup list below cursor (VSCode-style)
- Fuzzy matching with ranking
- Documentation preview pane
- Keyboard navigation (Up/Down, Enter, Escape)

**Settings:**
- Enable/disable auto-complete
- Trigger characters
- Auto-show delay (default: 300ms)
- Snippet library location

**Performance:**
- <50ms response time for completion matching
- <25ms for snippet expansion

### 2. Syntax Error Detection

**Error Catalog:**
- **E001-E050:** Syntax errors (missing closing brackets, invalid attributes)
- **W001-W050:** Warnings (deprecated syntax, inconsistent formatting)
- **I001-I050:** Info/Style suggestions (better alternatives, best practices)

**Visual Indicators:**
- Red underlines for errors
- Yellow underlines for warnings
- Blue underlines for info
- Gutter icons (ðŸ”´ ðŸŸ¡ ðŸ”µ)

**Quick Fixes:**
- Lightbulb icon (ðŸ’¡) on hover
- List of suggested fixes
- Apply fix with Enter or click

**Settings:**
- Enable/disable syntax checking
- Error severity levels to show
- Debounce delay (default: 500ms)
- Enable/disable quick fixes

**Performance:**
- <100ms for 1000-line document
- <500ms debounce after typing stops
- Real-time updates without UI blocking

### 3. Document Templates

**Built-in Templates (8):**
1. **Article** - Short technical article
2. **Book** - Multi-chapter book with TOC
3. **Man Page** - Unix manual page format
4. **Report** - Formal technical report
5. **README** - GitHub-style README
6. **Notes** - Simple note-taking document
7. **Tutorial** - Step-by-step tutorial
8. **API Documentation** - API reference template

**Template Format:**
- YAML front matter with metadata
- Variable substitution: `{{author}}`, `{{title}}`, `{{date}}`
- Conditional sections: `{{#if toc}}...{{/if}}`
- Includes: `{{include:header.adoc}}`

**UI:**
- Template browser dialog with categories
- Live preview pane
- Variable input form
- Recent templates list

**Custom Templates:**
- User-defined template directory
- Template creation wizard
- Import/export templates

**Settings:**
- Default template
- Template directories (built-in + custom)
- Variable defaults (author, organization)

**Performance:**
- <50ms template instantiation
- <100ms preview rendering

---

## Architecture Overview

### Module Structure

```
src/asciidoc_artisan/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ autocomplete_engine.py      # Completion matching and ranking
â”‚   â”œâ”€â”€ autocomplete_providers.py   # Syntax, Attribute, XRef, Include providers
â”‚   â”œâ”€â”€ syntax_checker.py           # Error detection core
â”‚   â”œâ”€â”€ syntax_validators.py        # Semantic, Style, BestPractice validators
â”‚   â”œâ”€â”€ template_engine.py          # Template loading and variable substitution
â”‚   â”œâ”€â”€ template_manager.py         # Template CRUD operations
â”‚   â””â”€â”€ models.py                   # Data models (CompletionItem, SyntaxError, Template)
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ autocomplete_widget.py      # Popup completion list
â”‚   â”œâ”€â”€ autocomplete_manager.py     # Auto-complete UI coordination
â”‚   â”œâ”€â”€ syntax_checker_manager.py   # Error underlines and gutter icons
â”‚   â”œâ”€â”€ syntax_error_panel.py       # Error list panel (optional)
â”‚   â”œâ”€â”€ template_browser.py         # Template selection dialog
â”‚   â””â”€â”€ template_variable_dialog.py # Variable input form
â””â”€â”€ templates/                       # Built-in template files
    â”œâ”€â”€ article.adoc
    â”œâ”€â”€ book.adoc
    â”œâ”€â”€ man-page.adoc
    â”œâ”€â”€ report.adoc
    â”œâ”€â”€ readme.adoc
    â”œâ”€â”€ notes.adoc
    â”œâ”€â”€ tutorial.adoc
    â””â”€â”€ api-docs.adoc
```

### Data Models

**CompletionItem:**
```python
@dataclass
class CompletionItem:
    text: str                    # Completion text
    kind: CompletionKind         # Syntax, Attribute, XRef, Include, Snippet
    detail: str                  # Short description
    documentation: str           # Full documentation (markdown)
    insert_text: str             # Text to insert (may differ from text)
    sort_text: Optional[str]     # Custom sorting key
    filter_text: Optional[str]   # Custom filter key
    score: float = 0.0           # Ranking score
```

**SyntaxError:**
```python
@dataclass
class SyntaxError:
    code: str                    # E001, W001, I001
    severity: ErrorSeverity      # ERROR, WARNING, INFO
    message: str                 # Human-readable message
    line: int                    # Line number (0-indexed)
    column: int                  # Column number (0-indexed)
    length: int                  # Error span length
    fixes: List[QuickFix]        # Suggested fixes
```

**QuickFix:**
```python
@dataclass
class QuickFix:
    title: str                   # Fix description
    edits: List[TextEdit]        # List of text edits
```

**Template:**
```python
@dataclass
class Template:
    name: str                    # Template name
    category: str                # article, book, report, etc.
    description: str             # Short description
    content: str                 # Template content
    variables: List[str]         # Required variables
    metadata: Dict[str, Any]     # YAML front matter
```

### Thread Safety

All features must be thread-safe:

- **Auto-Complete:** Completion matching runs in background thread, results delivered via signal
- **Syntax Checker:** Validation runs in background thread (debounced), errors delivered via signal
- **Templates:** Instantiation runs in main thread (fast enough), file I/O async

### Integration Points

**main_window.py:**
- Initialize managers in `__init__`
- Connect keyboard shortcuts
- Add menu items (Tools â†’ Auto-Complete Settings, Syntax Check, Templates)

**settings.py:**
- Add settings for all features
- Persist user preferences

**menu_manager.py:**
- Add "Insert Template" to File menu
- Add "Auto-Complete" to Edit menu
- Add "Syntax Check" to Tools menu

---

## Test Strategy

### Test Pyramid

| Level | Count | Purpose |
|-------|-------|---------|
| Unit Tests | 220+ | Core logic (engines, providers, validators) |
| Integration Tests | 50+ | Feature integration (managers, workers) |
| UI Tests | 10+ | Qt widgets (dialogs, popups) |
| **Total** | **280+** | Full coverage |

### Test Categories

**Phase 1 Tests (140):**
- AutoCompleteEngine: 40 tests (matching, ranking, filtering)
- SyntaxChecker: 50 tests (error detection, catalog)
- TemplateEngine: 30 tests (loading, variable substitution)
- Data models: 20 tests (validation, serialization)

**Phase 2 Tests (30+):**
- AutoComplete providers: 15 tests (syntax, attributes, xrefs)
- Syntax validators: 10 tests (semantic, style)
- TemplateManager: 5 tests (CRUD operations)

**Phase 3 Tests (30+):**
- AutoCompleteWidget: 10 tests (popup, keyboard navigation)
- SyntaxCheckerManager: 10 tests (underlines, gutter icons)
- TemplateBrowser: 10 tests (selection, preview)

**Phase 4 Tests (80+):**
- Snippet expansion: 20 tests
- Quick fixes: 30 tests
- Built-in templates: 20 tests (8 templates + variations)
- End-to-end: 10 tests

### Performance Tests

- Auto-complete response time: <50ms (1000 items)
- Syntax check: <100ms (1000-line document)
- Template instantiation: <50ms
- Startup time: <1.1s (no regression)

### Coverage Target

- **Goal:** 100% line coverage for new code
- **Minimum:** 95% line coverage

---

## Performance Requirements

### Performance Budgets

| Feature | Target | Maximum | Measurement |
|---------|--------|---------|-------------|
| Auto-complete response | <25ms | 50ms | Time from trigger to popup |
| Syntax check (1000 lines) | <50ms | 100ms | Time to validate document |
| Template instantiation | <20ms | 50ms | Time to fill variables |
| Startup time | <1.0s | 1.1s | Time to main window |
| Memory (idle) | 65MB | 105MB | After startup |

### Optimization Strategies

1. **Auto-Complete:**
   - Cache completion items
   - Incremental matching (don't recompute from scratch)
   - Limit results to 100 items

2. **Syntax Checker:**
   - Incremental validation (only changed lines)
   - Debounce typing (500ms default)
   - Cancel previous check if new text arrives

3. **Templates:**
   - Lazy load template files
   - Cache parsed templates
   - Async file I/O for custom templates

### Profiling

- Add benchmarks for all critical paths
- Profile before and after optimizations
- Document performance in commit messages

---

## Success Criteria

### Functional Requirements

- âœ… Auto-complete shows relevant completions (<50ms)
- âœ… Syntax checking detects 50+ error types
- âœ… Templates support 8 built-in types + custom
- âœ… All features configurable via Settings
- âœ… Keyboard shortcuts work (Ctrl+Space, F8, etc.)

### Quality Requirements

- âœ… 100% test pass rate (280+ tests)
- âœ… 100% test coverage for new code
- âœ… Zero critical bugs
- âœ… Performance budgets met
- âœ… Documentation complete (user guide, API reference)

### User Acceptance

- âœ… Auto-complete feels responsive (no lag)
- âœ… Syntax errors update in real-time
- âœ… Templates create valid documents
- âœ… Features don't interfere with typing flow

---

## Risk Management

### High-Risk Items

| Risk | Impact | Mitigation |
|------|--------|------------|
| Performance regression | HIGH | Continuous benchmarking, optimization budget |
| Qt integration complexity | MEDIUM | Prototype early, use existing patterns |
| Feature creep | MEDIUM | Strict scope, defer non-critical features to v2.1 |

### Medium-Risk Items

| Risk | Impact | Mitigation |
|------|--------|------------|
| Test flakiness | MEDIUM | Mock all I/O, deterministic tests |
| Template complexity | LOW | Start simple, iterate based on feedback |
| User adoption | LOW | Comprehensive docs, tutorial videos |

### Mitigation Strategies

1. **Performance:** Benchmark early and often
2. **Complexity:** Incremental implementation, small PRs
3. **Scope:** Defer optional features to v2.1
4. **Testing:** Write tests before implementation
5. **Documentation:** Update docs as code changes

---

## Timeline and Milestones

### 16-Week Schedule

| Week | Phase | Focus | Deliverables | Tests |
|------|-------|-------|--------------|-------|
| 1-2 | Phase 1 | Auto-complete core | `autocomplete_engine.py` | 40 |
| 2-3 | Phase 1 | Syntax checker core | `syntax_checker.py` | 50 |
| 3-4 | Phase 1 | Template core | `template_engine.py` | 50 |
| 5-6 | Phase 2 | Providers | `autocomplete_providers.py`, `syntax_validators.py` | 30 |
| 6-7 | Phase 2 | Managers | `template_manager.py` | 20 |
| 7-8 | Phase 2 | Integration | Backend complete | - |
| 9-10 | Phase 3 | Qt widgets | `autocomplete_widget.py`, `syntax_checker_manager.py` | 20 |
| 10-11 | Phase 3 | Template UI | `template_browser.py` | 10 |
| 11-12 | Phase 3 | Settings | Integration complete | - |
| 13-14 | Phase 4 | Features | Snippets, quick fixes, templates | 60 |
| 14-15 | Phase 4 | Documentation | User guide, API reference | - |
| 15-16 | Phase 4 | Polish | Bug fixes, performance tuning | 20 |

### Key Milestones

- **Week 4:** Phase 1 complete (core engines, 140 tests)
- **Week 8:** Phase 2 complete (providers, 170 tests)
- **Week 12:** Phase 3 complete (Qt integration, 200 tests)
- **Week 16:** v2.0.0 release (280 tests, documentation)

### Review Checkpoints

- **Week 4:** Architecture review, performance check
- **Week 8:** Feature review, integration testing
- **Week 12:** UI/UX review, user testing
- **Week 16:** Final review, release preparation

---

## Deferred Features (v2.1+)

**Not in v2.0.0 scope:**

- Multi-level caching for auto-complete
- Export presets (reusable export configurations)
- Editor themes (syntax highlighting themes)
- Custom snippet library UI
- Diagnostics panel (error list view)
- Template marketplace (cloud-based templates)
- Advanced template variables (conditionals, loops)
- Auto-complete from document content (local context)
- Grammar checking integration
- AI-powered auto-complete suggestions

**Rationale:** Focus on core functionality first, iterate based on user feedback.

---

## Dependencies

### System Dependencies

No new system dependencies required.

### Python Dependencies

**New:**
- `jinja2` - Template rendering (already used by Sphinx, widely adopted)
- `rapidfuzz` - Fast fuzzy matching for auto-complete

**Existing:**
- PySide6 - Qt widgets
- pytest - Testing

### Version Compatibility

- Minimum Python: 3.12+ (no change)
- Minimum PySide6: 6.9.0+ (no change)

---

## Documentation Plan

### User Documentation (20 pages)

1. **Auto-Complete Guide** (5 pages)
   - How to trigger auto-complete
   - Completion types and shortcuts
   - Creating custom snippets
   - Settings and customization

2. **Syntax Checking Guide** (5 pages)
   - Error types and severity levels
   - How to use quick fixes
   - Disabling specific rules
   - Settings and customization

3. **Templates Guide** (5 pages)
   - Using built-in templates
   - Creating custom templates
   - Variable syntax and conditionals
   - Template best practices

4. **Settings Reference** (3 pages)
   - All v2.0.0 settings
   - Default values
   - Performance tuning

5. **Troubleshooting** (2 pages)
   - Common issues and solutions
   - Performance problems
   - Bug reporting

### Developer Documentation

1. **Architecture Guide** - How the 3 systems work
2. **API Reference** - All public APIs
3. **Testing Guide** - How to add tests
4. **Contributing Guide** - How to extend features

---

## Conclusion

v2.0.0 transforms AsciiDoc Artisan into a professional technical writing environment with:

- **Auto-Complete** - Faster document creation
- **Syntax Checking** - Higher document quality
- **Templates** - Consistent structure

**Total Effort:** 102-160 hours over 16 weeks
**Total Tests:** 280+ (unit + integration + UI)
**Target Release:** September 2026

**Next Steps:**

1. Create detailed feature plans (Auto-Complete, Syntax, Templates)
2. Set up development environment
3. Begin Phase 1 implementation

---

**Last Updated:** November 8, 2025
**Document Owner:** AsciiDoc Artisan Development Team
**Status:** Ready for Implementation
